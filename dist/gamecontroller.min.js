!function(t){function e(t,i){var o,s,n,r,a=i,h=1,l=!0;if("boolean"==typeof t&&(l=t,h=2),"object"!=typeof t&&"function"!=typeof t&&(t={}),!a)return t;for(o in a)i=t[o],s=a[o],t!==s&&(l&&("object"==typeof s||(n="[object Array]"===Object.prototype.toString.call(s)))?(n?(n=!1,r=i&&"[object Array]"===Object.prototype.toString.call(i)?i:[]):r=i&&"object"==typeof i?i:{},t[o]=e(r,s)):"undefined"!=typeof s&&(t[o]=s));return t}var i,o,s=([].slice,{}.hasOwnProperty),n=function(t,e){function i(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};t.GameController={options:{left:{type:"dpad",position:{left:"13%",bottom:"22%"},dpad:{up:{width:"7%",height:"15%",stroke:2,touchStart:function(){GameController.simulateKeyEvent("press",38),GameController.simulateKeyEvent("down",38)},touchEnd:function(){GameController.simulateKeyEvent("up",38)}},left:{width:"15%",height:"7%",stroke:2,touchStart:function(){GameController.simulateKeyEvent("press",37),GameController.simulateKeyEvent("down",37)},touchEnd:function(){GameController.simulateKeyEvent("up",37)}},down:{width:"7%",height:"15%",stroke:2,touchStart:function(){GameController.simulateKeyEvent("press",40),GameController.simulateKeyEvent("down",40)},touchEnd:function(){GameController.simulateKeyEvent("up",40)}},right:{width:"15%",height:"7%",stroke:2,touchStart:function(){GameController.simulateKeyEvent("press",39),GameController.simulateKeyEvent("down",39)},touchEnd:function(){GameController.simulateKeyEvent("up",39)}}},joystick:{radius:60,touchMove:function(t){console.log(t)}}},right:{type:"buttons",position:{right:"17%",bottom:"28%"},buttons:[{offset:{x:"-13%",y:0},label:"X",radius:"7%",stroke:2,backgroundColor:"blue",fontColor:"#fff",touchStart:function(){GameController.simulateKeyEvent("press",88),GameController.simulateKeyEvent("down",88)},touchEnd:function(){GameController.simulateKeyEvent("up",88)}},{offset:{x:0,y:"-11%"},label:"Y",radius:"7%",stroke:2,backgroundColor:"yellow",fontColor:"#fff",touchStart:function(){GameController.simulateKeyEvent("press",70),GameController.simulateKeyEvent("down",70)},touchEnd:function(){GameController.simulateKeyEvent("up",70)}},{offset:{x:"13%",y:0},label:"B",radius:"7%",stroke:2,backgroundColor:"red",fontColor:"#fff",touchStart:function(){GameController.simulateKeyEvent("press",90),GameController.simulateKeyEvent("down",90)},touchEnd:function(){GameController.simulateKeyEvent("up",90)}},{offset:{x:0,y:"11%"},label:"A",radius:"7%",stroke:2,backgroundColor:"green",fontColor:"#fff",touchStart:function(){GameController.simulateKeyEvent("press",67),GameController.simulateKeyEvent("down",67)},touchEnd:function(){GameController.simulateKeyEvent("up",67)}}],dpad:{up:{width:"7%",height:"15%",stroke:2},left:{width:"15%",height:"7%",stroke:2},down:{width:"7%",height:"15%",stroke:2},right:{width:"15%",height:"7%",stroke:2}},joystick:{radius:60,touchMove:function(t){console.log(t)}}},touchRadius:45},touchableAreas:[],touchableAreasCount:0,touches:[],offsetX:0,offsetY:0,bound:{left:!1,right:!1,top:!1,bottom:!1},cachedSprites:{},paused:!1,init:function(t){if(!(!1 in document.documentElement)){t=t||{},e(this.options,t);var i=navigator.userAgent.toLowerCase();this.performanceFriendly=-1!==i.indexOf("iphone")||-1!==i.indexOf("android")||this.options.forcePerformanceFriendly;var o=document.getElementById(this.options.canvas);this.options.canvas&&o?o&&(this.options.canvas=o):this.options.canvas=document.getElementsByTagName("canvas")[0],this.options.ctx=this.options.canvas.getContext("2d"),this.createOverlayCanvas()}},boundingSet:function(t){var e,i,o,s;if(t.width)e=this.getPixels(t.width),i=this.getPixels(t.height),o=this.getPixels(t.x),s=this.getPixels(t.y);else{var n=this.options.touchRadius?2*this.getPixels(t.radius)+this.getPixels(this.options.touchRadius)/2:t.radius;e=i=2*(n+this.getPixels(t.stroke)),o=this.getPixels(t.x)-e/2,s=this.getPixels(t.y)-i/2}var r=o+e,a=s+i;(!this.bound.left||o<this.bound.left)&&(this.bound.left=o),(!this.bound.right||r>this.bound.right)&&(this.bound.right=r),(!this.bound.top||s<this.bound.top)&&(this.bound.top=s),(!this.bound.bottom||a>this.bound.bottom)&&(this.bound.bottom=a)},createOverlayCanvas:function(){var t=this;this.canvas=document.createElement("canvas"),this.resize(!0),document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),window.addEventListener("resize",function(){setTimeout(function(){GameController.resize.call(t)},10)}),this.setTouchEvents(),this.loadSide("left"),this.loadSide("right"),this.render(),this.touches&&this.touches.length||(this.paused=!0)},pixelRatio:1,resize:function(t){this.canvas.width=this.options.canvas.width,this.canvas.height=this.options.canvas.height,this.offsetX=GameController.options.canvas.offsetLeft+document.body.scrollLeft,this.offsetY=GameController.options.canvas.offsetTop+document.body.scrollTop,this.options.canvas.style.width&&this.options.canvas.style.height&&-1!==this.options.canvas.style.height.indexOf("px")&&(this.canvas.style.width=this.options.canvas.style.width,this.canvas.style.height=this.options.canvas.style.height,this.pixelRatio=this.canvas.width/parseInt(this.canvas.style.width)),this.canvas.style.position="absolute",this.canvas.style.zIndex="5",this.canvas.style.left=this.options.canvas.offsetLeft+"px",this.canvas.style.top=this.options.canvas.offsetTop+"px",this.canvas.setAttribute("style",this.canvas.getAttribute("style")+" -ms-touch-action: none;"),t||(this.touchableAreas=[],this.cachedSprites=[],this.reloadSide("left"),this.reloadSide("right"))},getPixels:function(t,e){return"undefined"==typeof t?0:"number"==typeof t?t:"x"==e?parseInt(t,10)/100*this.canvas.width:parseInt(t,10)/100*this.canvas.height},simulateKeyEvent:function(t,e){if("undefined"==typeof window.onkeydown)return!1;var i=document.createEvent("KeyboardEvent");-1!==navigator.userAgent.toLowerCase().indexOf("chrome")&&(Object.defineProperty(i,"keyCode",{get:function(){return this.keyCodeVal}}),Object.defineProperty(i,"which",{get:function(){return this.keyCodeVal}})),i.initKeyboardEvent?i.initKeyboardEvent("key"+t,!0,!0,document.defaultView,!1,!1,!1,!1,e,e):i.initKeyEvent("key"+t,!0,!0,document.defaultView,!1,!1,!1,!1,e,e),i.keyCodeVal=e},setTouchEvents:function(){var t=this,e=function(e){t.paused&&(t.paused=!1),e.preventDefault(),window.navigator.msPointerEnabled&&e.clientX&&e.pointerType==e.MSPOINTER_TYPE_TOUCH?t.touches[e.pointerId]={clientX:e.clientX,clientY:e.clientY}:t.touches=e.touches||[]},i=function(e){e.preventDefault(),window.navigator.msPointerEnabled&&e.pointerType==e.MSPOINTER_TYPE_TOUCH?delete t.touches[e.pointerId]:t.touches=e.touches||[],e.touches&&e.touches.length||(t.render(),t.paused=!0)},o=function(e){e.preventDefault(),window.navigator.msPointerEnabled&&e.clientX&&e.pointerType==e.MSPOINTER_TYPE_TOUCH?t.touches[e.pointerId]={clientX:e.clientX,clientY:e.clientY}:t.touches=e.touches||[]};this.canvas.addEventListener("touchstart",e,!1),this.canvas.addEventListener("touchend",i),this.canvas.addEventListener("touchmove",o),window.navigator.msPointerEnabled&&(this.canvas.addEventListener("MSPointerDown",e),this.canvas.addEventListener("MSPointerUp",i),this.canvas.addEventListener("MSPointerMove",o))},addTouchableDirection:function(t){var e=new a(t);e.id=this.touchableAreas.push(e),this.touchableAreasCount++,this.boundingSet(t)},addJoystick:function(t){var e=new l(t);e.id=this.touchableAreas.push(e),this.touchableAreasCount++,this.boundingSet(t)},addButton:function(t){var e=new h(t);e.id=this.touchableAreas.push(e),this.touchableAreasCount++,this.boundingSet(t)},addTouchableArea:function(t,e){},loadButtons:function(t){for(var e=this.options[t].buttons,i=0,o=e.length;o>i;i++)if(e[i]&&"undefined"!=typeof e[i].offset){var s=this.getPositionX(t),n=this.getPositionY(t);e[i].x=s+this.getPixels(e[i].offset.x,"y"),e[i].y=n+this.getPixels(e[i].offset.y,"y"),this.addButton(e[i])}},loadDPad:function(t){var e=this.options[t].dpad||{},i=this.getPositionX(t),o=this.getPositionY(t);if(e.up&&e.left&&e.down&&e.right){var s={x:i,y:o,radius:e.right.height},n=new d(s);this.touchableAreas.push(n),this.touchableAreasCount++}e.up||(e.up.x=i-this.getPixels(e.up.width,"y")/2,e.up.y=o-(this.getPixels(e.up.height,"y")+this.getPixels(e.left.height,"y")/2),e.up.direction="up",this.addTouchableDirection(e.up)),e.left||(e.left.x=i-(this.getPixels(e.left.width,"y")+this.getPixels(e.up.width,"y")/2),e.left.y=o-this.getPixels(e.left.height,"y")/2,e.left.direction="left",this.addTouchableDirection(e.left)),e.down||(e.down.x=i-this.getPixels(e.down.width,"y")/2,e.down.y=o+this.getPixels(e.left.height,"y")/2,e.down.direction="down",this.addTouchableDirection(e.down)),e.right||(e.right.x=i+this.getPixels(e.up.width,"y")/2,e.right.y=o-this.getPixels(e.right.height,"y")/2,e.right.direction="right",this.addTouchableDirection(e.right))},loadJoystick:function(t){var e=this.options[t].joystick;e.x=this.getPositionX(t),e.y=this.getPositionY(t),this.addJoystick(e)},reloadSide:function(t){this.loadSide(t)},loadSide:function(t){var e=this.options[t];"dpad"===e.type?this.loadDPad(t):"joystick"===e.type?this.loadJoystick(t):"buttons"===e.type&&this.loadButtons(t)},normalizeTouchPositionX:function(t){return(t-this.offsetX)*this.pixelRatio},normalizeTouchPositionY:function(t){return(t-this.offsetY)*this.pixelRatio},getXFromRight:function(t){return this.canvas.width-t},getYFromBottom:function(t){return this.canvas.height-t},getPositionX:function(t){return"undefined"!=typeof this.options[t].position.left?this.getPixels(this.options[t].position.left,"x"):this.getXFromRight(this.getPixels(this.options[t].position.right,"x"))},getPositionY:function(t){return"undefined"!=typeof this.options[t].position.top?this.getPixels(this.options[t].position.top,"y"):this.getYFromBottom(this.getPixels(this.options[t].position.bottom,"y"))},renderAreas:function(){for(var t=0,e=this.touchableAreasCount;e>t;t++){var i=this.touchableAreas[t];if("undefined"!=typeof i){i.draw();for(var o=!1,s=0,n=this.touches.length;n>s;s++){var r=this.touches[s];if("undefined"!=typeof r){var a=this.normalizeTouchPositionX(r.clientX),h=this.normalizeTouchPositionY(r.clientY);i.check(a,h)===!1||o||(o=this.touches[s])}}o?(i.active||i.touchStartWrapper(o),i.touchMoveWrapper(o)):i.active&&i.touchEndWrapper(o)}}},render:function(){if(this.paused&&this.performanceFriendly||this.ctx.clearRect(this.bound.left,this.bound.top,this.bound.right-this.bound.left,this.bound.bottom-this.bound.top),!this.paused&&!this.performanceFriendly){var t="touch-circle",e=this.cachedSprites[t],o=this.options.touchRadius;if(!e&&o){var s=document.createElement("canvas"),n=s.getContext("2d");s.width=2*o,s.height=2*o;var r=o,a=n.createRadialGradient(r,r,1,r,r,o);a.addColorStop(0,"rgba( 200, 200, 200, 1 )"),a.addColorStop(1,"rgba( 200, 200, 200, 0 )"),n.beginPath(),n.fillStyle=a,n.arc(r,r,o,0,2*Math.PI,!1),n.fill(),e=GameController.cachedSprites[t]=s}for(var h=0,l=this.touches.length;l>h;h++){var d=this.touches[h];if("undefined"!=typeof d){var c=this.normalizeTouchPositionX(d.clientX),u=this.normalizeTouchPositionY(d.clientY);c-o>this.bound.left&&c+o<this.bound.right&&u-o>this.bound.top&&u+o<this.bound.bottom&&this.ctx.drawImage(e,c-o,u-o)}}}this.paused&&this.performanceFriendly||this.renderAreas(),i(this.renderWrapper)},renderWrapper:function(){GameController.render()}};var r=function(){function t(){}return t.prototype.touchStart=null,t.prototype.touchMove=null,t.prototype.touchEnd=null,t.prototype.type="area",t.prototype.id=!1,t.prototype.active=!1,t.prototype.setTouchStart=function(t){this.touchStart=t},t.prototype.touchStartWrapper=function(t){this.touchStart&&this.touchStart(),this.active=!0},t.prototype.setTouchMove=function(t){this.touchMove=t},t.prototype.lastPosX=0,t.prototype.lastPosY=0,t.prototype.touchMoveWrapper=function(e){!this.touchMove||e.clientX==t.prototype.lastPosX&&e.clientY==t.prototype.lastPosY||(this.touchMove(),this.lastPosX=e.clientX,this.lastPosY=e.clientY),this.active=!0},t.prototype.setTouchEnd=function(t){this.touchEnd=t},t.prototype.touchEndWrapper=function(t){this.touchEnd&&this.touchEnd(),this.active=!1,GameController.render()},t}(),a=function(t){function e(t){for(var e in t)this[e]="x"==e?GameController.getPixels(t[e],"x"):"y"==e||"height"==e||"width"==e?GameController.getPixels(t[e],"y"):t[e];this.draw()}return n(e,t),e.prototype.type="direction",e.prototype.check=function(t,e){var i=GameController.options.touchRadius/2;return(Math.abs(t-this.x)<i||t>this.x)&&(Math.abs(t-this.x-this.width)<i||t<this.x+this.width)&&(Math.abs(e-this.y)<i||e>this.y)&&(Math.abs(e-this.y-this.height)<i||e<this.y+this.height)},e.prototype.draw=function(){var t,e=this.type+""+this.id+this.active,i=GameController.cachedSprites[e];if(!i){var o=document.createElement("canvas"),s=o.getContext("2d");o.width=this.width+2*this.stroke,o.height=this.height+2*this.stroke;var n=this.opacity||.9;switch(this.active||(n*=.5),this.direction){case"up":t=s.createLinearGradient(0,0,0,this.height),t.addColorStop(0,"rgba( 0, 0, 0, "+.5*n+" )"),t.addColorStop(1,"rgba( 0, 0, 0, "+n+" )");break;case"left":t=s.createLinearGradient(0,0,this.width,0),t.addColorStop(0,"rgba( 0, 0, 0, "+.5*n+" )"),t.addColorStop(1,"rgba( 0, 0, 0, "+n+" )");break;case"right":t=s.createLinearGradient(0,0,this.width,0),t.addColorStop(0,"rgba( 0, 0, 0, "+n+" )"),t.addColorStop(1,"rgba( 0, 0, 0, "+.5*n+" )");break;case"down":default:t=s.createLinearGradient(0,0,0,this.height),t.addColorStop(0,"rgba( 0, 0, 0, "+n+" )"),t.addColorStop(1,"rgba( 0, 0, 0, "+.5*n+" )")}s.fillStyle=t,s.fillRect(0,0,this.width,this.height),s.lineWidth=this.stroke,s.strokeStyle="rgba( 255, 255, 255, 0.1 )",s.strokeRect(0,0,this.width,this.height),i=GameController.cachedSprites[e]=o}GameController.ctx.drawImage(i,this.x,this.y)},e}(r),h=function(t){function e(t){for(var e in t)this[e]="x"===e?GameController.getPixels(t[e],"x"):"x"===e||"radius"===e?GameController.getPixels(t[e],"y"):t[e];this.draw()}return n(e,t),e.prototype.type="button",e.prototype.check=function(t,e){var i=this.radius+GameController.options.touchRadius/2;return Math.abs(t-this.x)<i&&Math.abs(e-this.y)<i},e.prototype.draw=function(){var t=this.type+""+this.id+this.active,e=GameController.cachedSprites[t];if(!e){var i=document.createElement("canvas"),o=i.getContext("2d");o.lineWidth=this.stroke,i.width=i.height=2*(this.radius+o.lineWidth);var s,n=o.createRadialGradient(this.radius,this.radius,1,this.radius,this.radius,this.radius);switch(this.backgroundColor){case"blue":n.addColorStop(0,"rgba(123, 181, 197, 0.6)"),n.addColorStop(1,"#105a78"),s="#0A4861";break;case"green":n.addColorStop(0,"rgba(29, 201, 36, 0.6)"),n.addColorStop(1,"#107814"),s="#085C0B";break;case"red":n.addColorStop(0,"rgba(165, 34, 34, 0.6)"),n.addColorStop(1,"#520101"),s="#330000";break;case"yellow":n.addColorStop(0,"rgba(219, 217, 59, 0.6)"),n.addColorStop(1,"#E8E10E"),s="#BDB600";break;case"white":default:n.addColorStop(0,"rgba( 255,255,255,.3 )"),n.addColorStop(1,"#eee")}o.fillStyle=this.active?s:n,o.strokeStyle=s,o.beginPath(),o.arc(i.width/2,i.width/2,this.radius,0,2*Math.PI,!1),o.fill(),o.stroke(),this.label&&(o.fillStyle=s,o.font="bold "+(this.fontSize||.35*i.height)+"px Verdana",o.textAlign="center",o.textBaseline="middle",o.fillText(this.label,i.height/2+2,i.height/2+2),o.fillStyle=this.fontColor,o.font="bold "+(this.fontSize||.35*i.height)+"px Verdana",o.textAlign="center",o.textBaseline="middle",o.fillText(this.label,i.height/2,i.height/2)),e=GameController.cachedSprites[t]=i}GameController.ctx.drawImage(e,this.x,this.y)},e}(r),l=function(t){function e(t){for(var e in t)this[e]=t[e];this.currentX=this.currentX||this.x,this.currentY=this.currentY||this.y}return n(e,t),e.prototype.type="joystick",e.prototype.check=function(t,e){var i=this.radius+GameController.getPixels(GameController.options.touchRadius)/2;return Math.abs(t-this.x)<i&&Math.abs(e-this.y)<i},e.prototype.moveDetails={},e.prototype.touchMoveWrapper=function(t){this.currentX=GameController.normalizeTouchPositionX(t.clientX),this.currentY=GameController.normalizeTouchPositionY(t.clientY),this.touchMove&&this.moveDetails.dx!=this.currentX-this.x&&this.moveDetails.dy!=this.y-this.currentY&&(this.moveDetails.dx=this.currentX-this.x,this.moveDetails.dy=this.y-this.currentY,this.moveDetails.max=this.radius+GameController.options.touchRadius/2,this.moveDetails.normalizedX=this.moveDetails.dx/this.moveDetails.max,this.moveDetails.normalizedY=this.moveDetails.dy/this.moveDetails.max,this.touchMove(this.moveDetails)),this.active=!0},e.prototype.draw=function(){if(!this.id)return!1;var t,e=this.type+""+this.id+this.active,i=GameController.cachedSprites[e];if(!i){var o=document.createElement("canvas");this.stroke=this.stroke||2,o.width=o.height=2*(this.radius+GameController.options.touchRadius+this.stroke);var s=o.getContext("2d");s.lineWidth=this.stroke,this.active?(t=s.createRadialGradient(0,0,1,0,0,this.radius),t.addColorStop(0,"rgba( 200,200,200,.5 )"),t.addColorStop(1,"rgba( 200,200,200,.9 )"),s.strokeStyle="#000"):(t=s.createRadialGradient(0,0,1,0,0,this.radius),t.addColorStop(0,"rgba( 200,200,200,.2 )"),t.addColorStop(1,"rgba( 200,200,200,.4 )"),s.strokeStyle="rgba( 0,0,0,.4 )"),s.fillStyle=t,s.beginPath(),s.arc(this.radius,this.radius,this.radius,0,2*Math.PI,!1),s.fill(),s.stroke(),i=GameController.cachedSprites[e]=o}GameController.ctx.fillStyle="#444",GameController.ctx.beginPath(),GameController.ctx.arc(this.x,this.y,.7*this.radius,0,2*Math.PI,!1),GameController.ctx.fill(),GameController.ctx.stroke(),GameController.ctx.drawImage(i,this.currentX-this.radius,this.currentY-this.radius)},e}(r),d=function(t){function e(t){for(var e in t)this[e]="x"==e?GameController.getPixels(t[e],"x"):"x"==e||"radius"==e?GameController.getPixels(t[e],"y"):t[e];this.draw()}return n(e,t),e.prototype.check=function(t,e){return!1},e.prototype.draw=function(){GameController.ctx.fillStyle="rgba( 0, 0, 0, 0.5 )",GameController.ctx.beginPath(),GameController.ctx.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),GameController.ctx.fill()},e}(r);!function(){if("undefined"==typeof module){var t=0,e=["ms","moz","webkit","o"];i=window.requestAnimationFrame,o=window.cancelAnimationFrame;for(var s=0;s<e.length&&!i;++s)i=window[e[s]+"RequestAnimationFrame"],o=window[e[s]+"CancelAnimationFrame"]||window[e[s]+"CancelRequestAnimationFrame"];i||(i=function(e,i){var o=(new Date).getTime(),s=Math.max(0,16-(o-t)),n=window.setTimeout(function(){e(o+s)},s);return t=o+s,n}),o||(o=function(t){clearTimeout(t)})}}()}("undefined"!=typeof module?module.exports:window);